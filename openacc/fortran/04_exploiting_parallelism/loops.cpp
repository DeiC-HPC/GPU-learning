#include <iostream>
#include <stdlib.h>
#include <time.h>

using namespace std;

int main() {
  int num = 500;
  int memsize = num * num * num;
  long long *elements = (long long *)malloc(memsize * sizeof(long long));

  clock_t start, end;

#pragma acc data copyout(elements[:memsize])
  {
#pragma acc parallel loop
    for (long long i = 0; i < memsize; i++) {
      elements[i] = i;
    }

    start = clock();

    for (int i = 0; i < num; i++) {
      for (int j = 1; j < num; j++) {
#pragma acc parallel loop
        for (int k = 0; k < num; k++) {
          elements[i * num * num + j * num + k] +=
              elements[i * num * num + (j - 1) * num + k];
        }
      }
    }
  }

  end = clock();

  cout << "Elapsed time: " << (double)(end - start) / CLOCKS_PER_SEC << endl;

  cout << elements[memsize - 1] << endl;
}
